do {
    wait(order)
    wait(mutex);
    read_count++;
    if (read_count == 1)
        wait(rw_mutex);
    signal(order)
    signal(mutex);
    // read is performed
    wait(mutex);
    read_count--;
    if (read_count == 0)
        signal(rw_mutex);
    signal(mutex);
} while (true);


do {
    wait(order)
    wait(rw_mutex);
    signal(order)
    ..
    // write is performed
    â€¦
    signal(rw_mutex);
} while (true);